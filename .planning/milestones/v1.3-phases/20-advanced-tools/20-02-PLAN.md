---
phase: 20-advanced-tools
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - tutorials/07-graph-editor.md
autonomous: true
requirements:
  - VIS-01

must_haves:
  truths:
    - "User can launch the graph editor with rsf ui and see their workflow rendered as a visual graph"
    - "User can make a visual change (add a state, rename a state, or rearrange) and see the YAML update in real time"
    - "User can save the edited workflow back to disk from the graph editor"
  artifacts:
    - path: "tutorials/07-graph-editor.md"
      provides: "Step-by-step rsf ui tutorial with launch, visual editing, YAML sync, and save walkthrough"
      min_lines: 180
  key_links:
    - from: "tutorials/07-graph-editor.md"
      to: "src/rsf/cli/ui_cmd.py"
      via: "Documents the exact behavior of rsf ui"
      pattern: "rsf ui"
    - from: "tutorials/07-graph-editor.md"
      to: "src/rsf/editor/server.py"
      via: "Documents the FastAPI server and WebSocket architecture"
      pattern: "launch"
---

<objective>
Create a comprehensive step-by-step tutorial for `rsf ui` that walks users through launching the graph editor, visually editing a workflow, and seeing YAML updates in real time.

Purpose: Users need a hands-on guide to use the visual graph editor for workflow design — launching the server, navigating the UI, making visual changes to their workflow graph, seeing the Monaco YAML editor sync in real time, and saving edits back to disk.
Output: `tutorials/07-graph-editor.md` — a complete tutorial document.
</objective>

<execution_context>
@/home/esa/.claude/get-shit-done/workflows/execute-plan.md
@/home/esa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/rsf/cli/ui_cmd.py
@src/rsf/editor/server.py
@src/rsf/editor/websocket.py
@tutorials/01-project-setup.md
@tutorials/05-iterate-invoke-teardown.md

<interfaces>
<!-- The rsf ui command behavior (from src/rsf/cli/ui_cmd.py):

  Arguments:
    workflow: Path to workflow YAML file (default: "workflow.yaml")

  Options:
    --port / -p: Port to serve on (default: 8765)
    --no-browser: Don't auto-open browser (default: False)

  Behavior:
  1. Prints: "Starting RSF Graph Editor on port {port}..."
  2. Creates FastAPI app with:
     - GET /api/schema — returns JSON Schema for the RSF DSL
     - WebSocket /ws — bidirectional DSL operations
     - Static files (React SPA at / if build exists)
  3. Auto-loads the workflow file on WebSocket connect
  4. Opens browser to http://127.0.0.1:{port}
  5. Runs until Ctrl+C → prints "Server stopped"

  WebSocket message types:
  - parse: YAML string → parsed definition dict + validation errors
  - validate: YAML string → validation errors only
  - load_file: file path → YAML contents
  - save_file: file path + YAML → write to disk
  - get_schema: → JSON Schema for DSL

  The UI is a React SPA with:
  - A graph visualization panel showing states as nodes and transitions as edges
  - A Monaco YAML editor panel with real-time validation
  - Bidirectional sync: edit YAML → graph updates; edit graph → YAML updates
  - Inline validation errors displayed on both graph and YAML sides
-->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write the rsf ui tutorial</name>
  <files>tutorials/07-graph-editor.md</files>
  <action>
Create the file `tutorials/07-graph-editor.md` with the following structure and content:

**Title:** "Tutorial 7: Visual Editing with `rsf ui`"

**Sections to include (in order):**

1. **What You'll Learn** — Brief overview: launch the RSF graph editor, view your workflow as a visual graph, edit the graph and see YAML update in real time, edit YAML and see the graph update, save your changes back to disk.

2. **Prerequisites** —
   - RSF installed (`pip install rsf`)
   - A workflow YAML file (from Tutorial 1 or Tutorial 6). If the user does not have one, provide a quick workflow to create:
     ```yaml
     rsf_version: "1.0"
     Comment: "Order processing workflow"
     StartAt: ValidateOrder

     States:
       ValidateOrder:
         Type: Task
         Next: CheckAmount

       CheckAmount:
         Type: Choice
         Choices:
           - Variable: "$.amount"
             NumericGreaterThan: 100
             Next: RequireApproval
         Default: ProcessOrder

       RequireApproval:
         Type: Task
         Next: ProcessOrder

       ProcessOrder:
         Type: Task
         End: true
     ```
   - A modern web browser (the editor runs as a local web application)
   - No AWS account needed — the graph editor is fully local

3. **Step 1: Launch the Graph Editor** — Show the exact command:
   ```bash
   rsf ui
   ```
   Show expected terminal output:
   ```
   Starting RSF Graph Editor on port 8765...
   ```
   Explain: the command starts a local web server and opens your browser to `http://127.0.0.1:8765`. The server loads `workflow.yaml` from the current directory automatically. If you want to load a different file, pass the path: `rsf ui my-workflow.yaml`. Use `--port` to change the port: `rsf ui --port 9000`. Use `--no-browser` to prevent the browser from opening automatically.

   > **Tip:** The server runs in the foreground. Keep this terminal open while you use the editor. Press Ctrl+C to stop the server when you are done.

4. **Step 2: Navigate the Editor Interface** — Describe the two-panel layout:
   - **Left panel: Graph view** — Your workflow rendered as a directed graph. Each state is a node with its type displayed. Transitions (Next, Default, Choice branches) are drawn as edges between nodes. The graph auto-layouts based on the workflow structure.
   - **Right panel: YAML editor** — A Monaco code editor showing the full YAML source. Syntax highlighting, line numbers, and inline validation errors.
   - **Toolbar** — Save button, validation status indicator.

   Explain what the user should see for the order processing workflow:
   - Four nodes: ValidateOrder (Task), CheckAmount (Choice), RequireApproval (Task), ProcessOrder (Task)
   - Edges showing the flow: ValidateOrder → CheckAmount → RequireApproval/ProcessOrder (branching), RequireApproval → ProcessOrder
   - The Choice node shows two outgoing edges (one for the condition, one for Default)

5. **Step 3: Edit YAML and Watch the Graph Update** — Walk the user through editing the YAML in the right panel:
   - Add a new state between ProcessOrder and the end. In the YAML editor, change `ProcessOrder` to have `Next: SendConfirmation` instead of `End: true`, then add a new state:
     ```yaml
     SendConfirmation:
       Type: Task
       End: true
     ```
   - As soon as the YAML is valid, the graph re-renders with the new `SendConfirmation` node and an edge from `ProcessOrder` to it.
   - Explain: the editor validates YAML on every keystroke and updates the graph when the YAML is structurally valid. If you introduce a syntax error, the graph freezes at the last valid state and the editor shows the error inline.

6. **Step 4: Edit the Graph and Watch the YAML Update** — Walk the user through making a change in the graph panel:
   - Describe how to interact with the graph to rename a state, reorder transitions, or modify state properties (the exact interaction depends on the React SPA implementation — describe conceptually: click a node to select it, use the property panel or inline editing to modify, changes reflect in the YAML editor immediately).
   - Explain: the bidirectional sync means you can use whichever editing mode is more comfortable. Complex structural changes (adding Choice branches, Parallel states) are often easier in YAML, while understanding flow and catching disconnected states is easier in the graph.

7. **Step 5: Check Validation Errors** — Intentionally break the YAML to see validation in action:
   - Remove the `StartAt` field from the YAML
   - The graph editor shows a validation error (red indicator in toolbar, inline error in YAML editor)
   - Fix it by adding `StartAt` back
   - Explain: the editor runs the same 3-stage validation as `rsf validate` (YAML syntax, structural, semantic) — errors appear instantly as you type.

8. **Step 6: Save Your Changes** — Explain how to save:
   - Click the Save button in the toolbar (or use the keyboard shortcut if available)
   - The editor sends a `save_file` WebSocket message, writing the current YAML back to the workflow file on disk
   - Confirm the save by checking the file:
     ```bash
     cat workflow.yaml
     ```
   - The saved file contains the updated workflow with the `SendConfirmation` state added in Step 3.

9. **Stopping the Server** — In the terminal where `rsf ui` is running, press Ctrl+C:
   ```
   Server stopped
   ```
   The browser tab remains open but the connection is lost. Close it manually.

10. **What's Next** — Point to Tutorial 8 (rsf inspect) for inspecting live executions of deployed workflows. Mention that workflows edited in the graph editor can be validated (`rsf validate`), generated (`rsf generate`), and deployed (`rsf deploy`) using the same pipeline from Tutorials 2-5.

**Style guidelines (follow exactly):**
- Follow the established tutorial patterns from Tutorials 1-6
- Use clear, direct language. No marketing fluff.
- Every command should be in a fenced code block with `bash` syntax highlighting.
- Use blockquotes (> ) for important notes or tips.
- Keep explanations concise — 2-4 sentences per concept.
- Do NOT use emojis.
- Describe UI elements clearly for users who cannot see the screenshots — this is a text-only tutorial.
- The graph editor is a local tool — emphasize that no AWS account or internet connection is needed.
  </action>
  <verify>
    <automated>test -f tutorials/07-graph-editor.md && wc -l tutorials/07-graph-editor.md | awk '{if ($1 >= 180) print "PASS: "$1" lines"; else print "FAIL: only "$1" lines"}'</automated>
  </verify>
  <done>
    - tutorials/07-graph-editor.md exists with 180+ lines
    - Tutorial covers: launching rsf ui, navigating the two-panel layout (graph + YAML editor), editing YAML and watching graph update, editing graph and watching YAML update, validation errors in real time, saving changes back to disk, stopping the server
    - Bidirectional sync demonstrated: YAML→graph and graph→YAML
    - Validation error demonstration included (remove StartAt, see error, fix)
    - No AWS account required — fully local tool
    - Command options documented (--port, --no-browser, custom workflow path)
    - Pointer to Tutorial 8 (rsf inspect)
  </done>
</task>

</tasks>

<verification>
1. `tutorials/07-graph-editor.md` exists and has 180+ lines
2. Tutorial documents rsf ui command with correct default behavior (port 8765, auto-open browser)
3. Two-panel layout described: graph view + Monaco YAML editor
4. Bidirectional sync demonstrated in both directions
5. Validation errors shown inline in the editor
6. Save workflow back to disk demonstrated
7. Commands are concrete (`rsf ui`, `rsf ui --port 9000`)
8. No AWS dependency — fully local workflow
</verification>

<success_criteria>
A user reading this tutorial can: launch the graph editor with `rsf ui`, see their workflow as a visual graph, make edits in both YAML and graph panels, observe real-time sync between them, and save their changes back to disk.
</success_criteria>

<output>
After completion, create `.planning/phases/20-advanced-tools/20-02-SUMMARY.md`
</output>
