---
phase: 28-f401-unused-imports
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/rsf/cli/templates/test_example.py
  - src/rsf/codegen/generator.py
  - src/rsf/dsl/choice.py
  - src/rsf/dsl/errors.py
  - src/rsf/dsl/models.py
  - src/rsf/dsl/parser.py
  - src/rsf/dsl/validator.py
  - src/rsf/editor/server.py
  - src/rsf/editor/websocket.py
  - src/rsf/functions/__init__.py
  - src/rsf/registry/registry.py
  - tests/test_cli/test_deploy.py
  - tests/test_cli/test_ui.py
  - tests/test_codegen/test_generator.py
  - tests/test_codegen/test_state_mappers.py
  - tests/test_context/test_context.py
  - tests/test_dsl/test_models.py
  - tests/test_dsl/test_parser.py
  - tests/test_dsl/test_validator.py
  - tests/test_editor/test_websocket.py
  - tests/test_examples/test_harness.py
  - tests/test_importer/test_importer.py
  - tests/test_inspect/test_server.py
  - tests/test_integration/test_sdk_integration.py
  - tests/test_mock_sdk/test_mock_context.py
  - tests/test_registry/test_registry.py
  - tests/test_terraform/test_terraform.py
  - examples/data-pipeline/tests/test_local.py
  - examples/intrinsic-showcase/tests/test_local.py
  - examples/retry-and-recovery/tests/test_local.py
autonomous: true
requirements: [F401-01, F401-02, F401-03, F401-04, F401-05]

must_haves:
  truths:
    - "All unused imports in src/ are removed or justified with inline noqa"
    - "All unused imports in tests/ are removed"
    - "All unused imports in examples/ are removed"
    - "Side-effect imports in functions/__init__.py have noqa: F401 comments"
    - "Generated code in codegen/generator.py preserves its noqa: F401 pattern"
  artifacts:
    - path: "src/rsf/functions/__init__.py"
      provides: "Side-effect imports with noqa: F401 comments"
      contains: "noqa: F401"
    - path: "src/rsf/codegen/generator.py"
      provides: "Generated handler init with noqa: F401"
      contains: "noqa: F401"
  key_links:
    - from: "src/rsf/functions/__init__.py"
      to: "rsf.functions.array, encoding, json_funcs, math, string, utility"
      via: "side-effect import for @intrinsic decorator registration"
      pattern: "# noqa: F401"
---

<objective>
Fix all 61 F401 (unused import) violations across src/, tests/, and examples/.

Purpose: Eliminate all unused imports so that when F401 is removed from the global ignore list, zero violations are reported. Side-effect imports in functions/__init__.py get inline `# noqa: F401` comments to preserve their intentional registration behavior.

Output: All 30 files cleaned of unused imports; side-effect imports annotated.
</objective>

<execution_context>
@/home/esa/.claude/get-shit-done/workflows/execute-plan.md
@/home/esa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix F401 violations in src/ (27 violations across 11 files)</name>
  <files>
    src/rsf/cli/templates/test_example.py
    src/rsf/codegen/generator.py
    src/rsf/dsl/choice.py
    src/rsf/dsl/errors.py
    src/rsf/dsl/models.py
    src/rsf/dsl/parser.py
    src/rsf/dsl/validator.py
    src/rsf/editor/server.py
    src/rsf/editor/websocket.py
    src/rsf/functions/__init__.py
    src/rsf/registry/registry.py
  </files>
  <action>
Fix all F401 violations in src/ by removing unused imports or adding inline noqa comments.

**For each file, apply the appropriate fix:**

1. **src/rsf/functions/__init__.py** — SPECIAL CASE: The 6 imports (array, encoding, json_funcs, math, string, utility) are side-effect imports for @intrinsic decorator registration. Do NOT remove them. Add `# noqa: F401` to the import line. Change:
   ```python
   from rsf.functions import array, encoding, json_funcs, math, string, utility
   ```
   to:
   ```python
   from rsf.functions import array, encoding, json_funcs, math, string, utility  # noqa: F401
   ```

2. **src/rsf/codegen/generator.py** — DO NOT modify this file. The `# noqa: F401` on line 195 is in generated code output and is already correct. The `typing.Any` import on some other line IS unused and should be removed. Check if `Any` is actually used in the file — if not, remove the import.

3. **All other src/ files** — Simply remove the unused import lines. The violations are:
   - `src/rsf/cli/templates/test_example.py`: Remove `import pytest` (unused)
   - `src/rsf/dsl/choice.py`: Remove `typing.Literal` and `rsf.dsl.types.COMPARISON_OPERATORS` from their import lines
   - `src/rsf/dsl/errors.py`: Remove `typing.Any` and `pydantic.model_validator` from their import lines
   - `src/rsf/dsl/models.py`: Remove `typing.Annotated`, `typing.Optional`, `typing.Union` from their import lines
   - `src/rsf/dsl/parser.py`: Remove `pydantic.ValidationError` from its import line
   - `src/rsf/dsl/validator.py`: Remove `dataclasses.field`, `BranchDefinition`, `PassState`, `TaskState`, `WaitState`, `DataTestRule`, `Catcher`, `RetryPolicy` from their import lines
   - `src/rsf/editor/server.py`: Remove `typing.Any` from its import line
   - `src/rsf/editor/websocket.py`: Remove `rsf.schema.generate.generate_json_schema` from its import line
   - `src/rsf/registry/registry.py`: Remove `typing.Any` from its import line

**Important:** When removing an import from a multi-import line (e.g., `from typing import Any, Dict, List`), only remove the unused name, keeping the rest. If the unused name is the only import on the line, remove the entire line. Clean up any resulting empty import statements or trailing commas.

**Do NOT** introduce any new imports or modify any logic — only remove unused imports or add noqa comments.
  </action>
  <verify>
    <automated>cd /home/esa/git/rsf-python && ruff check --select F401 src/ 2>&1 | grep "^F401" | wc -l</automated>
    Expected output: 0 (zero F401 violations in src/)
  </verify>
  <done>ruff check --select F401 src/ reports zero violations. Side-effect imports in functions/__init__.py have noqa: F401. Generated code pattern in codegen/generator.py is preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Fix F401 violations in tests/ and examples/ (34 violations across 19 files)</name>
  <files>
    tests/test_cli/test_deploy.py
    tests/test_cli/test_ui.py
    tests/test_codegen/test_generator.py
    tests/test_codegen/test_state_mappers.py
    tests/test_context/test_context.py
    tests/test_dsl/test_models.py
    tests/test_dsl/test_parser.py
    tests/test_dsl/test_validator.py
    tests/test_editor/test_websocket.py
    tests/test_examples/test_harness.py
    tests/test_importer/test_importer.py
    tests/test_inspect/test_server.py
    tests/test_integration/test_sdk_integration.py
    tests/test_mock_sdk/test_mock_context.py
    tests/test_registry/test_registry.py
    tests/test_terraform/test_terraform.py
    examples/data-pipeline/tests/test_local.py
    examples/intrinsic-showcase/tests/test_local.py
    examples/retry-and-recovery/tests/test_local.py
  </files>
  <action>
Fix all F401 violations in tests/ (28 violations, 16 files) and examples/ (6 violations, 3 files) by removing unused imports.

**For tests/ files** — remove each unused import. The violations include stdlib imports (asyncio, json, pathlib.Path, pytest, re, tempfile, time), unittest.mock imports (call, MagicMock), and rsf-specific imports (various model/type classes). For each file:
1. Run `ruff check --select F401 {file}` to see exact unused imports
2. Remove each unused import name from its import line
3. If removing the last name from a line, remove the entire import statement
4. Clean up any trailing commas or empty parentheses

**For examples/ files:**
- `examples/data-pipeline/tests/test_local.py`: Remove `rsf.registry.state` and `rsf.registry.get_handler` from the import line
- `examples/intrinsic-showcase/tests/test_local.py`: Remove `import pytest`
- `examples/retry-and-recovery/tests/test_local.py`: Remove `typing.Any`, `rsf.registry.state`, and `rsf.registry.get_handler` from their import lines

**Important:** When removing from multi-import lines like `from rsf.registry import state, get_handler`, if both names are unused, remove the entire line. If the file also imports other things from the same module on other lines, leave those. Ensure no blank lines or formatting issues are introduced.

**After fixing all files**, run the full test suite to confirm nothing is broken. Tests should still pass (removing truly unused imports cannot break functionality).
  </action>
  <verify>
    <automated>cd /home/esa/git/rsf-python && ruff check --select F401 tests/ examples/ 2>&1 | grep "^F401" | wc -l</automated>
    Expected output: 0 (zero F401 violations in tests/ and examples/)
  </verify>
  <done>ruff check --select F401 tests/ reports zero violations. ruff check --select F401 examples/ reports zero violations. Test suite passes (308+ tests, no regressions).</done>
</task>

</tasks>

<verification>
1. `ruff check --select F401 src/ tests/ examples/ 2>&1 | grep "^F401" | wc -l` returns 0
2. `.venv/bin/python -m pytest tests/ -x -q` passes (308+ tests, same as before)
3. `grep -c "noqa: F401" src/rsf/functions/__init__.py` returns 1 (side-effect imports annotated)
4. `grep "noqa: F401" src/rsf/codegen/generator.py` still shows the generated code pattern
</verification>

<success_criteria>
- Zero F401 violations reported by ruff across src/, tests/, and examples/
- All existing tests continue to pass
- Side-effect imports in functions/__init__.py preserved with noqa: F401
- Generated code noqa pattern in codegen/generator.py unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/28-f401-unused-imports/28-01-SUMMARY.md`
</output>
